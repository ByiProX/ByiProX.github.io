---
title: 三次握手 | 四次挥手
date: 2018-03-19 23:30:52
tags:
  - 网络
categories:
  - 网络
---
## 三次握手
**第一次握手**

建立连接时，客户端发送`syn包（syn=j）`到服务器，并进入SYN_SENT状态，等待服务器确认；
SYN即`同步序列编号`(synchronize sequence numbers)。

**第二次握手**

服务器收到`syn包`，必须确认客户的SYN（ack = j+1）,同时自己也发送一个SYN包（syn=k），即发`送SYN和ACK包`，此时服务器进入`SYN_RECV`状态。


**第三次握手**

客户端收到服务器的`SYN+ACK包`，向服务器发送确认`包ACK（ack=k+1）`，此包发送完毕，客户端和服务器进入`ESTABLISHED`状态，TCP连接成功，完成三次握手。

完成上述三次握手后，客户端和服务器开始传送数据。


## 四次挥手
对于一个已经建立的连接，TCP使用改进的三次握手来释放连接（使用一个带有FIN附加标记的字段）。TCP关闭连接的步骤如下

1. 当主机A的应用程序通知TCP数据已经发送完毕时，TCP向主机B发送一个带有FIN附加标记的报文段（FIN=finish）
2. 当主机B收到这个FIN报文段之后，并不立即用FIN报文回复主机A，而是想主机A发送一个确认序号ACK，同时通知自己的应用程序：对方要求关闭连接。【先发送ACK的目的是为了防止在这段时间内，对方重传FIN报文】
3. 主机B的应用程序告诉TCP：我要彻底关闭连接，TCP向主机A发送一个FIN报文段。
4. 主机A收到这个FIN报文段后，向主机B发送一个ACK表示连接彻底释放。
