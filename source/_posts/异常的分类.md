---
title: 异常的分类
date: 2019-02-20 15:24:54
tags:
  - 操作系统
categories:
  - 操作系统
---

异常可以分为四类：`中断(interrupt)、陷阱(trap)、故障(fault)、终止(abort)`.


| 类别     | 原因       | 异步/同步 | 返回行为 |
| ------- | ---------- | ---- |   --------   |
|中断|来自I/O设备的信号|异步|总是返回下一条指令|
|陷阱| 有意的异常|同步|总是返回下一条指令|
|故障|潜在可恢复的错误|同步|可能返回到当前指令|
|终止|不可恢复的错误|同步|不会返回|

异步异常时由处理器外部的I/O设备中的事件产生的。同步异常是执行一条指令的直接产物。

<!-- more -->
## 中断
中断时异步发生的，来自处理器外部的I/O设备的信号结果。剩下的异常类型是同步发生的，是执行当前指令的结果，我们把这类指令叫做故障指令。

## 陷阱
`陷阱`最重要的用途是用在用户程序和内核之间提供一个像过程一样的接口，叫做`系统调用`
从程序员的角度看，系统调用和普通的函数调用是一样的。然而，它们的实现非常不同。普通函数运行在`用户模式`中，用户模式限制了函数可以执行的指令的类型，而且它们只能访问与调用函数相同的栈。系统调用在`内核模式`中，内核模式允许系统调用执行特权指令，并访问定义在内核中的栈。

## 故障
故障由错误引起，它可能能够被故障处理程序修正。根据故障是否能够被修复，故障处理程序要么重新执行引起故障的指令，要么终止。

一个经典的故障示例是`缺页异常`，当指令引用一个虚拟地址，而与该地址相对应的物理页面不在内存中，因此必须从磁盘中读取时，就会发生故障。一个页面就是虚拟内存中的一个连续的块（典型的是4KB），缺页处理程序从磁盘加载适当的页面，然后将控制返回给引起故障的指令。当指令再次执行是，相应的物理页面已经驻留在内存中了，指令就可以没有故障的运行完成了。

## 终止
终止是不可恢复的致命错误造成的结果，通常是一些硬件错误，比如DRAM或者SRAM位被损坏时发生的奇偶错误。终止处理程序从不将控制返回给应用程序，处理程序将控制返回给一个abort例程，该例程会终止这个应用程序。


----
参考资料：深入理解计算机系统第三版P504
